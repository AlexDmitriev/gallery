var GalleryApplication;GalleryApplication=new Marionette.Application,GalleryApplication.navigate=function(e,t){t||(t={}),Backbone.history.navigate(e,t)},GalleryApplication.getCurrentRoute=function(){return Backbone.history.fragment},GalleryApplication.addRegions({mainRegion:"#main-region"}),GalleryApplication.on("start",function(){Backbone.history&&Backbone.history.start({pushState:!0,root:baseUrl})}),GalleryApplication.module("App",function(e,t,o,a,l,n){return e.AlbumModel=o.Model.extend(),e.AlbumsCollection=o.Collection.extend({model:e.AlbumModel,url:function(){return baseUrl+"api"}}),e.AlbumDetailsModel=o.Model.extend({url:function(){return baseUrl+"api/"+this.id+"/"+this.attributes.page}}),e.ImageModel=o.Model.extend()}),GalleryApplication.module("App",function(e,t,o,a,l,n){e.LoaderView=a.ItemView.extend({template:"#loader-template"}),e.ErrorView=a.ItemView.extend({template:"#error-template"}),e.AlbumsView=a.CollectionView.extend({getChildView:function(){return e.AlbumView}}),e.AlbumView=a.ItemView.extend({template:"#albums-item-template",events:{"click a.js-show-album":"showAlbum","click a.js-show-image":"showImage"},showImage:function(e){e.preventDefault(),t.trigger("image:show",l(e.currentTarget).attr("href"))},showAlbum:function(e){e.preventDefault(),t.navigate("album/"+this.model.get("id"),!0)}}),e.AlbumDetailsView=a.ItemView.extend({template:"#albums-details-template",events:{"click a.js-back-to-albums":"backToAlbumsClicked","click a.js-show-album-page":"showAlbumPage","click a.js-show-image":"showImage"},backToAlbumsClicked:function(e){e.preventDefault(),t.navigate("",!0)},showImage:function(e){e.preventDefault(),t.trigger("image:show",l(e.currentTarget).attr("href"))},showAlbumPage:function(e){e.preventDefault(),t.navigate("album/"+this.model.get("id")+"/"+l(e.currentTarget).attr("page"),!0)}}),e.ImageView=a.ItemView.extend({template:"#album-image-template",events:{"click a.js-close":"close"},close:function(e){return e.preventDefault(),t.trigger("image:close")}}),e.LayoutView=a.LayoutView.extend({template:"#gallery-template",regions:{image:"#image-block",body:"#body-block"}}),e.appLayout=new e.LayoutView,t.mainRegion.show(e.appLayout)}),GalleryApplication.module("App",function(e,t,o,a,l,n){var i;i=[],e.Controller=a.Controller.extend({home:function(){0===i.length?(i=new e.AlbumsCollection,e.appLayout.getRegion("body").show(new e.LoaderView),i.fetch().done(function(){e.appLayout.getRegion("body").show(new e.AlbumsView({collection:i}))})):e.appLayout.getRegion("body").show(new e.AlbumsView({collection:i}))},album:function(t,o){var a;o||(o=1),a=new e.AlbumDetailsModel({id:t,page:o}),e.appLayout.getRegion("body").show(new e.LoaderView),a.fetch({success:function(){e.appLayout.getRegion("body").show(new e.AlbumDetailsView({model:a}))},error:function(){e.appLayout.getRegion("body").show(new e.ErrorView)}})}}),t.on("image:show",function(t){e.appLayout.getRegion("image").show(new e.ImageView({model:new e.ImageModel({image:t})}))}),t.on("image:close",function(t){e.appLayout.getRegion("image").reset()}),t.on("album:show",function(e){t.navigate("album/"+e.get("id"))})}),GalleryApplication.module("App",function(e,t,o,a,l,n){e.Router=a.AppRouter.extend({appRoutes:{"":"home","album/:id":"album","album/:id/:page":"album","app_dev.php":"home","app_dev.php/album/:id":"album","app_dev.php/album/:id/:page":"album"},controller:new e.Controller}),e.on("start",function(){new e.Router})});